!function(){"use strict";const e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],t=t=>{let n=0;for(let s=0;s<t.length;s++){const o=t[s];n=83*n+e.indexOf(o)}return n},n={sRGBToLinear:e=>{const t=e/255;return t<=.04045?t/12.92:((t+.055)/1.055)**2.4},linearTosRGB:e=>{const t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.round(12.92*t*255+.5):Math.round(255*(1.055*t**(1/2.4)-.055)+.5)},signPow:(e,t)=>(e<0?-1:1)*Math.abs(e)**t};class s extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}}const o=e=>{const t=e>>16,s=e>>8&255,o=255&e;return[n.sRGBToLinear(t),n.sRGBToLinear(s),n.sRGBToLinear(o)]},a=(e,t)=>{const s=Math.floor(e/361),o=Math.floor(e/19)%19,a=e%19;return[n.signPow((s-9)/9,2)*t,n.signPow((o-9)/9,2)*t,n.signPow((a-9)/9,2)*t]},r=(e,r,l,i)=>{(e=>{if(!e||e.length<6)throw new s("The blurhash string must be at least 6 characters");const n=t(e[0]),o=Math.floor(n/9)+1,a=n%9+1;if(e.length!==4+2*a*o)throw new s(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*a*o}`)})(e),i|=1;const c=t(e[0]),h=Math.floor(c/9)+1,m=c%9+1,u=(t(e[1])+1)/166,f=new Array(m*h);for(let n=0;n<f.length;n++)if(0===n){const s=t(e.substring(2,6));f[n]=o(s)}else{const s=t(e.substring(4+2*n,6+2*n));f[n]=a(s,u*i)}const d=4*r,g=new Uint8ClampedArray(d*l);for(let e=0;e<l;e++)for(let t=0;t<r;t++){let s=0,o=0,a=0;for(let n=0;n<h;n++)for(let i=0;i<m;i++){const c=Math.cos(Math.PI*t*i/r)*Math.cos(Math.PI*e*n/l),h=f[i+n*m];s+=h[0]*c,o+=h[1]*c,a+=h[2]*c}const i=n.linearTosRGB(s),c=n.linearTosRGB(o),u=n.linearTosRGB(a);g[4*t+0+e*d]=i,g[4*t+1+e*d]=c,g[4*t+2+e*d]=u,g[4*t+3+e*d]=255}return g},l=[];function i(e,t,n,s){const o=r(e,t,n),a=function(e,t){let n=l.filter(e=>e&&!1===e.used)[0];return n?n.ctx.clearRect(0,0,n.element.width,n.element.height):(n={},"undefined"!=typeof window&&window.document?n.element=document.createElement("canvas"):n.element=new OffscreenCanvas(e,t),n.ctx=n.element.getContext("2d"),l.push(n)),n.element.width=e,n.element.height=t,n.imageData=n.ctx.createImageData(e,t),n.used=!0,n}(t,n);a.imageData.data.set(o),a.ctx.putImageData(a.imageData,0,0),"undefined"!=typeof HTMLCanvasElement&&a.element instanceof HTMLCanvasElement?a.element.msToBlob?s(a.element.msToBlob()):a.element.toBlob(e=>{a.used=!1,s(e)}):"undefined"!=typeof OffscreenCanvas&&a.element instanceof OffscreenCanvas&&a.element.convertToBlob().then(e=>{a.used=!1,s(e)})}onmessage=e=>{const[t,n,s]=e.data;i(t,n,s,e=>{postMessage(e)})}}();
