/* ------------------------
 Nav + Header
------------------------ */

$opennav_timing: .3s;



// Default - hide menu until main menu is set up
.menu { display: none; }


// I. Header
$navh: 6rem;
%nav-height { height: $navh; }
%nav-menu-position {  top: calc(#{$navh} - .05em); }
%nav-menu-minheight { min-height: calc(100vh - #{$navh}); }

.site-header {
  @extend %nav-height;
  @extend %clear;

  width: 100%;
  z-index: 999;

  &> .gutenberg-container, .logo-div { height: 100%; }

  .logo-a, .logo-img { display: block; }

  .logo-a path { fill: rgba(255,255,255,.8); }

  .logo-a {
    height: 100%;
    float: left;  // float: left so that clicking logo is disambiguated from clicking menu icon
    @include flex;
    @include align-items(center);
  }

  .logo-img { height: calc(100% - 1rem); }
}




// II. Nav
#navmenu {
  @extend %nav-menu-position;

  width: 100%;
  background: $gray1;
  position: absolute;
   left: 0;
  z-index: 900;

  [href] { text-decoration: none; }
}

// using .container-on-mobile allows for a smooth full height dropdown
// applying height to #navmenu looks choppy and bad
#navmenu > .container-on-mobile {
  @extend %nav-menu-minheight;
  width: 100%;
  height: 100%;
  margin: 0;
}

.navbar-collapse {

  &.collapse {
    clip-path: polygon(0 0, 100% 0, 100% 0, 0 0);
    @include transition(clip-path, .4s, ease);
  }

  &.collapse.show {
    height: auto;
    display: block;
    clip-path: polygon(0 0, 100vw 0, 100vw 100%, 0 100%);
    overflow: scroll;
    position: relative;
  }
}


#navmenu ul  {
  list-style-type: none;
  margin: 0;
  padding: 0;

  // position relative on ALL li allows for correct display
  // of current nav dot on mobile
  li { position: relative; }

  &> li { letter-spacing: .05em; }

  &> li > a {
    border-bottom: .05rem solid rgba(255,255,255,.1);
  }
}


#navmenu .navbar-nav {  // div > ul
  overflow: scroll;
  -webkit-overflow-scrolling: touch;

  &> li {
    background: transparent;
    font-size: 1rem;
    position: relative;
    text-transform: uppercase;
    @include transition-one(background);

    &> a {
      padding: 1rem 1.5rem 1rem 2rem;
    }
  }

  a {
    width: 100%;
    color: white;
    display: inline-block;
    @include transition-multi(background .2s ease-in-out, color .2s ease-in-out);

    @include hover { color: $nearblack; text-decoration: none; }
  }
}



// III. Nav toggle
.navbar-toggler:focus { outline: -webkit-focus-ring-color auto 5px; }

.navbar-toggler {
  width: 3rem;
  height: 3rem;
  background: transparent;
  border: none;
  padding: 0;

  position: absolute;
   top: 1rem;
   right: 2rem;

  z-index: 910;

  .icon-bar {
    width: 80%;
    height: .2em;
    background: gray;
    display: block;
  }

  &> .opennav { position: absolute; left: 10%; }


  // middle
  &.collapsed > .opennav.-middle { opacity: 1; }
  &> .opennav.-middle {
    @extend %toggle_middle;
    @include transition(opacity, $opennav_timing, ease-in-out);
  }


  // the hamburger
  &.collapsed {
    &> .opennav.-top,
    &> .opennav.-bottom {
      @include rotate(0deg);
    }

    &>.opennav.-top {
      @extend %toggle_top;
      @include transform(0deg, (1,1), 0, 0, 0);
    }

    &>.opennav.-bottom {
      @extend %toggle_bottom;
      @include transform(0deg, (1,1), 0, 0, 0);
    }
  }


  // the x
  &[aria-expanded="true"] > .opennav {

    &.-top {
      @extend %toggle_top_bottom_collapsed;
      @include animation(toggle_top, ease-in-out, 1, $opennav_timing);
      @include transform(45deg, (1,1), 0, 0, 0);
    }

    &.-bottom {
      @extend %toggle_top_bottom_collapsed;
      @include animation(toggle_bottom, ease-in-out, 1, $opennav_timing);
      @include transform(-45deg, (1,1), 0, 0, 0);
    }

    &.-middle { opacity: 0; }
  }
}




// from x to hamburger
.navbar-toggler.user-collapsed.collapsed {
  &>.opennav.-top { @include animation(toggle_top_collapsed, ease-in-out, 1, $opennav_timing); }
  &>.opennav.-bottom { @include animation(toggle_bottom_collapsed, ease-in-out, 1, $opennav_timing); }
}




// IV. Nav submenu
#navmenu .navbar-nav .menu-item-has-children > .open-submenu-a {

  // 1. show the caret for top-level menu items with class .menu-item-has-children
  width: 7rem;
  height: 3.1rem;
  background-color: transparent;
  border-left: .05rem solid rgba(255,255,255,.1);
  display: block;

  position: absolute;
   top: 0;
   right: 0;

  &:after {
    width: 7em;
    height: 3rem;
    transform: rotate(0deg) scale(1) skew(0deg) translateX(0px) translateY(0px);
    content: "";
    display: block;
    position: absolute;
    right: 0;
    top: 0;
    background-position: calc(50% + 3px) calc(50% + 2px);
    background-repeat: no-repeat;

    @include transform(0deg, 1, 0, 0, 0);
    @include transition-multi(background-image .2s ease-in-out, -webkit-transform .2s ease-in-out, -moz-transform .2s ease-in-out, -ms-transform .2s ease-in-out, -o-transform .2s ease-in-out, transform .2s ease-in-out);

    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='8' overflow='visible'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' fill='%23FFF' d='M12.598 0L6.529 5.859 0 0h12.598z'/%3E%3C/svg%3E");
  }



  // 2. caret behavior on hover
  //    - cursor: pointer
  //    - change color
  @include hover {
    cursor: pointer;

    &:after {
      background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='8' overflow='visible'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' fill='111111' d='M12.598 0L6.529 5.859 0 0h12.598z'/%3E%3C/svg%3E");
    }
  }



  // 3. caret behvaior on click (spins 180deg)
  &.mobile-show-submenu:after {
    @include transform(180deg, 1, 0deg, 0, 0);
  }



  // 4. show full submenu if
  //    - caret was clicked and submemu has class .mobile-show-submenu
  //    - current page is a child page of a menu item and strict.js adds .mobile-show-submemu to submenu
  &.mobile-show-submenu + .sub-menu { max-height: unset; height: 100%; }


  // 5. default submenu appearance - hidden by height
  &+ .sub-menu {
    background: rgba(0,0,0,.1);
    display: block;
    max-height: 0;
    overflow: hidden;
    text-transform: none;

    @include transition(max-height, 2s, ease-in);

    // 6. submenu item padding
    a { padding: 1rem 0 1rem 3.5rem; }
  }

}




// V. Current

// 1. Children
%current-nav-a {
  &:before {
    display: block;
    content: '';
    width: .4rem;
    height: .4rem;
    @include border-radius(.2rem);
    background: white;

    position: absolute;
     top: 1.3rem;
     left: 1rem;
  }
}

#navmenu .sub-menu .current-menu-item > a { @extend %current-nav-a; }



// 2. Parents
%current-page-or-current-parent-li { // mobile top level links get
  background: rgba(0,0,0,.2);
}

#navmenu .navbar-nav > li.current-menu-item,
#navmenu .navbar-nav > li.current-menu-parent {
  // current top level pages
  // and parents of current page
  // get shading
  @extend %current-page-or-current-parent-li;
}


#navmenu .navbar-nav > li.current-menu-item  {
  // current top level pages get the dot
  &> a { @extend %current-nav-a; }
}
